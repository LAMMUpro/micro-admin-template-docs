## 常见问题

### iframe创建请求父应用资源问题

子应用 iframe 初始化时加载、执行了主应用的资源

> 使用empty.html, 主应用提供一个路径比如说 `https://host/empty.html`, iframe的src指向这个地址

```javascript
microApp.start({
  tagName: 'micro-app-main',
  /** 防止子应用请求父应用资源（部署时需要配置这个url指向这个文件） */
  iframeSrc: '/micromain/empty.html',
})
```

### 字体图标冲突(被覆盖)

> 写脚本检测? 加应用前缀?

父子应用的字体图标冲突?

### xxx is not defined

**原因：** 脚本本来在全局执行，此时第三方包定义的全局变量（比如`var xxx`）会直接挂载到`window`上。但是`wujie`将所有的脚本都包裹在一个闭包内运行方便劫持修改`location`，所以这些全局变量会留在闭包内，无法挂载到`window`上，子应用的异步脚本会在另一个闭包内运行，所以拿不到这些全局变量。

**解决方案：**

1、方式一：需要将第三方包定义的全局变量显式的挂载到`window`上（比如`window.xxx`），或者修改第三方包`webpack`的[`output.libraryTarget`](https://webpack.docschina.org/configuration/output/#outputlibrarytarget)

2、方式二：如果用户不想修改代码可以通过[插件](https://wujie-micro.github.io/doc/guide/plugin.html#js-loader)的形式在运行时将全局定义的代码 `xxx=`替换成`window.xxx=`


### 子应用不生效的api

- `<script type="importmap">`

  子应用排除掉第三方依赖，想通过importmap指定加载第三方依赖是不可行的（子应用单独运行生效，在`<micro-app-head>`的importmap是无效的，框架没有处理）

  ```html
  <script type="importmap">
    {
      "imports": {
        "vue": "/admin/vue.esm-browser.js",
        "vue-router": "/admin/vue-router.esm-browser.js",
        "@micro-zoe/micro-app": "/admin/micro-app.1.0.0.rc.5.esm.js",
        "element-plus": "/admin/element-plus.2.2.20.full.mjs.js",
      }
    }
  </script>
  ```

  解决方案：使用rollup的rollupOptions.output.paths代替importmap